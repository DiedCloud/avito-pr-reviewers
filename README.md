# Тестовое задание для стажёра Backend (осенняя волна 2025)
## Сервис назначения ревьюеров для Pull Request’ов


## Запуск

Приложение конфигурируется посредствам переменных окружения. Реализация - [config.py](src/config.py)

[docker-compose.yml](docker-compose.yml) также берёт их значения из окружения.
Поэтому сейчас в репозиторий добавлен .env файл со стандартными переменными окружения

```bash
docker-compose up
```

## Стек

Язык: `python` + `FastAPI`

БД: `postgres`

## Документация

Изначальная спецификация - [openapi.yml](openapi.yml)

Итоговая спецификация доступна после запуска по http://localhost:8080
(Генерируемая с помощью FastAPI)

## Описание дополнений / допущений

### Формат `user_id` и `pull_request_id`

В примерах запросах в [openapi.yml](openapi.yml) тип полей id был String. 
Так как использовать в качестве первичного произвольные строки без какого-либо формата
может быть неэффективным, я захотел ограничить их каким-нибудь форматом.

Первой идеей был UUID. С этим типом и многие бд работать умеют, и генерировать их можно не боясь пересечений.

Потом я заметил, что в примерах были указаны id в формате `u1`, `pr-1`.
Соответственно, я решил проверять именно этот шаблон.

А вскоре понял, что если я, итак, уже требую такой формат,
то лучше хранить их в целочисленном виде и преобразовать формат при получениях и отправках.

Поэтому теперь endpoint-ы при несоответствии id этим шаблонам (`u1`, `pr-1`) будут возвращать 422.
А в базе хранятся привычные integer.

### Авторизация

Я подумал, что было бы неплохо добавить возможность авторизации.
Но так как это может замедлить проверку, то по умолчанию она выключены.
Изменяется это переменной окружения `AUTH_ENABLED`

Регистрация - `POST /auth/register`

```bash
curl -X 'POST' \
  'http://127.0.0.1:8080/auth/register' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "login": "string",
  "password": "string"
}'
```

Авторизация `POST /auth/login`

На вход принимает form-data, для авторизации через openapi frontend

```bash
curl -X 'POST' \
  'http://127.0.0.1:8080/auth/login' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -d 'grant_type=password&username=string&password=********&scope=&client_id=string&client_secret=********'
```

### Реализованные дополнительные задания

- Endpoint статистики. http://127.0.0.1:8080/stats
- Настроены linter (ruff), formater (ruff), type-checker (mypy) в [CI](.github/workflows/ci.yml)
- `+` SAST и SCA проверки в CI с добавлением результатов во вкладку security репозитория
и созданием артефакта с sarif файлом
- `+` Возможность авторизации через JWT (по умолчанию выключено для большей совместимости с заданием)
- ~~Endpoint массовой деактивации пользователей команды~~ - не реализовано
- ~~End-to-end тестирование~~ - не реализовано, но подготовлено окружение для тестов
- ~~Нагрузочное тестирование~~ - не реализовано
